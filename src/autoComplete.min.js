var a,b;a=this,b=function(){"use strict";function s(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function l(t){return"string"==typeof t?document.querySelector(t):t()}function a(t){return t.innerHTML=""}function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}var u="data-result",n="autoComplete_results_list",c="autoComplete_result",e="autoComplete_highlighted",i=l,r=function(t){var e=document.createElement(t.element);return e.setAttribute("id",n),t.container&&t.container(e),t.destination.insertAdjacentElement(t.position,e),e},h=function(t){return"<span class=".concat(e,">").concat(t,"</span>")},o=function(i,r,o){r.forEach(function(t,e){var n=document.createElement(o.element),s=r[e].value[t.key]||r[e].value;n.setAttribute(u,s),n.setAttribute("class",c),n.setAttribute("tabindex","1"),o.content?o.content(t,n):n.innerHTML=t.match||t,i.appendChild(n)})},d=function(t,n,s){var i=l(t),r=n.firstChild;document.onkeydown=function(t){var e=s.activeElement;switch(t.keyCode){case 38:e!==r&&e!==i?e.previousSibling.focus():e===r&&i.focus();break;case 40:e===i&&0<n.childNodes.length?r.focus():e!==n.lastChild&&e.nextSibling.focus()}}},f=a,m=function(n,s,i,r){var o=s.querySelectorAll(".".concat(c));Object.keys(o).forEach(function(e){["mousedown","keydown"].forEach(function(t){o[e].addEventListener(t,function(e){"mousedown"!==t&&13!==e.keyCode&&39!==e.keyCode||(i({event:e,query:l(n)instanceof HTMLInputElement?l(n).value:l(n).innerHTML,matches:r.matches,results:r.list.map(function(t){return t.value}),selection:r.list.find(function(t){return(t.value[t.key]||t.value)===e.target.closest(".".concat(c)).getAttribute(u)})}),a(s))})})})};t.prototype=window.Event.prototype;var v={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||t,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})}};return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector||"#autoComplete",this.data={src:function(){return"function"==typeof t.data.src?t.data.src():t.data.src},key:t.data.key,cache:void 0===t.data.cache||t.data.cache},this.query=t.query,this.triggerEvent=t.triggerEvent||["input"],this.searchEngine="loose"===t.searchEngine?"loose":"strict",this.customEngine=!!t.customEngine&&t.customEngine,this.threshold=t.threshold||0,this.debounce=t.debounce||0,this.resultsList={render:!(!t.resultsList||!t.resultsList.render)&&t.resultsList.render,shadowRoot:t.resultsList.shadowRoot||document,view:t.resultsList&&t.resultsList.render?r({container:!(!t.resultsList||!t.resultsList.container)&&t.resultsList.container,destination:t.resultsList&&t.resultsList.destination?t.resultsList.destination:i(this.selector),position:t.resultsList&&t.resultsList.position?t.resultsList.position:"afterend",element:t.resultsList&&t.resultsList.element?t.resultsList.element:"ul"}):null,navigation:{customMethod:!(!t.resultsList.navigation||!t.resultsList.navigation.customMethod)&&t.resultsList.navigation.customMethod}},this.sort=t.sort||!1,this.placeHolder=t.placeHolder,this.maxResults=t.maxResults||5,this.resultItem={content:!(!t.resultItem||!t.resultItem.content)&&t.resultItem.content,element:t.resultItem&&t.resultItem.element?t.resultItem.element:"li"},this.noResults=t.noResults,this.highlight=t.highlight||!1,this.onSelection=t.onSelection,this.dataSrc,this.init()}return function(t,e,n){e&&s(t.prototype,e),n&&s(t,n)}(e,[{key:"search",value:function(t,e){var n=e.toLowerCase();if("loose"===this.searchEngine){t=t.replace(/ /g,"");for(var s=[],i=0,r=0;r<n.length;r++){var o=e[r];i<t.length&&n[r]===t[i]&&(o=this.highlight?h(o):o,i++),s.push(o)}return i===t.length&&s.join("")}if(n.includes(t))return t=new RegExp("".concat(t),"i").exec(e),this.highlight?e.replace(t,h(t)):e}},{key:"listMatchedResults",value:function(n,s){var u=this;return new Promise(function(t){var a=[];n.filter(function(n,s){function t(t){if(t?n[t]:n){var e=u.customEngine?u.customEngine(u.queryValue,n[t]||n):u.search(u.queryValue,n[t]||n);e&&t?a.push({key:t,index:s,match:e,value:n}):e&&!t&&a.push({index:s,match:e,value:n})}}if(u.data.key){var e=!0,i=!1,r=void 0;try{for(var o,l=u.data.key[Symbol.iterator]();!(e=(o=l.next()).done);e=!0){t(o.value)}}catch(t){i=!0,r=t}finally{try{e||null==l.return||l.return()}finally{if(i)throw r}}}else t()});var e=u.sort?a.sort(u.sort).slice(0,u.maxResults):a.slice(0,u.maxResults);return u.resultsList.render&&(o(u.resultsList.view,e,u.resultItem),u.resultsList.navigation.customMethod?u.resultsList.navigation.customMethod(s,u.resultsList.view,i(u.selector)):d(u.selector,u.resultsList.view,u.resultsList.shadowRoot)),t({matches:a.length,list:e})})}},{key:"ignite",value:function(){var a=this,u=i(this.selector);this.placeHolder&&u.setAttribute("placeholder",this.placeHolder);function n(e){function n(t,e){u.dispatchEvent(new v.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:t,input:s,query:i,matches:e?e.matches:null,results:e?e.list:null},cancelable:!0}))}var s=u instanceof HTMLInputElement?u.value.toLowerCase():u.innerHTML.toLowerCase(),i=a.queryValue=a.query&&a.query.manipulate?a.query.manipulate(s):s,t=a.resultsList.render,r=i.length>a.threshold&&i.replace(/ /g,"").length;if(t){var o=a.onSelection,l=a.resultsList.view;f(l);r?a.listMatchedResults(a.dataSrc,e).then(function(t){n(e,t),0===t.list.length&&a.noResults&&a.resultsList.render?a.noResults():o&&m(a.selector,l,o,t)}):n(e)}else!t&&r?a.listMatchedResults(a.dataSrc,e).then(function(t){n(e,t)}):n(e)}this.triggerEvent.forEach(function(t){u.addEventListener(t,function(n,s){var i;return function(){var t=this,e=arguments;clearTimeout(i),i=setTimeout(function(){return n.apply(t,e)},s)}}(function(t){return function(e){if(a.data.cache)n(e);else{var t=a.data.src();t instanceof Promise?t.then(function(t){a.dataSrc=t,n(e)}):(a.dataSrc=t,n(e))}}(t)},a.debounce))})}},{key:"init",value:function(){var e=this,t=this.data.src();t instanceof Promise?t.then(function(t){e.dataSrc=t,e.ignite()}):(this.dataSrc=t,this.ignite()),v.initElementClosestPolyfill()}}]),e}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
